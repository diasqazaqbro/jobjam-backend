# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Flow –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ OAuth

```bash
# –î–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ HeadHunter
curl -I "http://localhost:3001/auth/hh?state=mobile"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# HTTP/1.1 302 Found
# Location: https://hh.kz/oauth/authorize?response_type=code&client_id=...&redirect_uri=...&state=mobile
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ callback —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ code)

```bash
# –¢–µ—Å—Ç –æ—à–∏–±–∫–∏ - –Ω–µ—Ç code
curl -I "http://localhost:3001/auth/hh/callback?state=mobile"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# HTTP/1.1 302 Found
# Location: jobjam://auth/callback?error=no_code
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)

```bash
# –° –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:3001/auth/me"

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# 200 OK —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## üîç –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Backend

### 1. **–ü–∞—Ä–∞–º–µ—Ç—Ä state —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π**
```typescript
@Query('state') state?: string  // –ë—ã–ª–æ: state: string
```

### 2. **URL encoding –¥–ª—è —Ç–æ–∫–µ–Ω–∞ –∏ –æ—à–∏–±–æ–∫**
```typescript
const encodedToken = encodeURIComponent(token);
return res.redirect(`jobjam://auth/callback?token=${encodedToken}`);
```

### 3. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏

### 4. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- –í—Å–µ –æ—à–∏–±–∫–∏ URL-encoded
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è FRONTEND_URL

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [x] `state` –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π
- [x] –¢–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ URL-encoded –≤ redirect
- [x] –û—à–∏–±–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ URL-encoded
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ `isMobile` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Fallback –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ flow

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ backend:**
   ```bash
   cd backend
   npm run start:dev
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –¥–æ—Å—Ç—É–ø–µ–Ω:**
   ```bash
   curl http://localhost:3001/auth/hh?state=mobile
   ```

3. **–í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
   - –ù–∞–∂–º–∏—Ç–µ "Login with hh.kz"
   - –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ HeadHunter
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ deep link –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: Redirect –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `HH_REDIRECT_URI` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö HeadHunter —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `HH_REDIRECT_URI` –≤ backend

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ deep link
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ URL-encoded (—Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### –ü—Ä–æ–±–ª–µ–º–∞: state –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `/auth/hh?state=mobile` –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

